<style scoped lang="scss" >
.layout {
  .orderConfirm-tab {
    margin-top: 20px;
  }
  .content {
    font-size: 14px;
    margin: 20px 0 20px 0;

    .box-card_1 {
      padding-left: 20px;
      width: 100%;
      /*background-color: azure;*/
      .content_1 {
        /*background-color: goldenrod;*/
        border-bottom: 1px solid #dcdcdc;
        div:nth-of-type(1) {
          p:nth-of-type(1) {
            margin-top: 20px;
            color: #4a3f91;
            font-size: 18px;
            font-weight: bold;
            span:nth-of-type(2) {
              width: 18.17%;
            }
            span:nth-of-type(3) {
              margin-left: 21.7%;
            }
          }
        }
        div:nth-of-type(2) {
          font-size: 0.93rem;
          padding: 10px 0;
          p:nth-of-type(1) {
            width: 300px;
            display: inline-block;
          }
          p:nth-of-type(2) {
            width: 300px;
            display: inline-block;
          }
          p:nth-of-type(3) {
            display: inline-block;
            float: right;
            margin-right: 32%;
          }
        }

        /*p:nth-of-type(2){*/
        /*margin-top: 10px;*/
        /*margin-bottom: 20px;*/
        /*span:nth-of-type(1){*/
        /*}*/
        /*span:nth-of-type(2){*/
        /*margin-left: 12%;*/
        /*width: 18.17%;*/
        /*}*/
        /*span:nth-of-type(3){*/
        /*float: right;*/
        /*margin-right: 32%;*/
        /*}*/
        /*}*/
      }
      .content_2 {
        /*background-color: seashell;*/
        p:nth-of-type(1) {
          margin-top: 20px;
          margin-bottom: 10px;
          color: #4a3f91;
          font-size: 16px;
          font-weight: bold;
          span:nth-of-type(1) {
          }
          span:nth-of-type(2) {
            margin-left: 250px;
          }
          span:nth-of-type(3) {
            margin-left: 150px;
          }
          span:nth-of-type(4) {
            margin-left: 150px;
          }
        }
        p:nth-of-type(2) {
          margin-bottom: 10px;
          button {
            width: 94px;
            height: 22px;
            background-color: #fff;
            color: #f08519;
            border: 1px solid #f08519;
          }
          span:nth-of-type(3) {
            margin-left: 150px;
          }
          button:nth-of-type(1) {
            margin-left: 152px;
          }
          button:nth-of-type(2) {
            margin-left: 142px;
          }
        }
        p:nth-of-type(3) {
          margin-bottom: 20px;
          span:nth-of-type(1) {
          }
          span:nth-of-type(3) {
            margin-left: 136px;
          }
          span:nth-of-type(4) {
            margin-left: 136px;
          }
        }
      }
    }

    .box-card_2 {
      margin: 20px 0 0 0;
      overflow: inherit;
      .header {
        font-size: 18px;
        overflow: hidden;
        margin-bottom: 10px;
        img {
          float: left;
          margin-top: -2px;
        }
        span {
          font-weight: 600;
        }
      }
      .content_1 {
        overflow: hidden;
        margin-bottom: 20px;
        .ASDSA {
          width: 233px;
          height: 138px;
          border: 1px solid #dcdcdc;
          float: left;
          margin-right: 30px;
          text-align: center;
          div:nth-of-type(1) {
            margin-top: 10px;
            position: relative;
            span {
              position: relative;
              bottom: 10px;
              font-size: 18px;
            }
          }
          div:nth-of-type(2) span {
            font-size: 18px;
            color: #f08519;
          }
        }
      }
      .content_2 {
        overflow: hidden;
        position: relative;
        margin-bottom: 20px;
        .ASDSA {
          width: 233px;
          height: 138px;
          border: 1px solid #dcdcdc;
          float: left;
          margin-right: 30px;
          overflow: hidden;
          div {
            margin-top: 28px;
            margin-left: 34px;
            .el-checkbox_label {
              font-size: 16px !important;
              font-weight: bold;
            }
            p {
              color: #808080;
            }
          }
        }
        .jiahao {
          font-size: 26px;
          font-weight: bold;
          position: absolute;
          top: 44px;
          left: 238px;
          color: #666666;
        }
      }
      .content_3 {
        .select_1 {
          width: 220px;
          margin-right: 20px;
          margin-bottom: 20px;
        }
        .el-date-editor {
          margin-bottom: 20px;
        }
        .checkbox3 {
          margin-right: 110px;
        }
        .input1 {
          width: 80px;
        }
        .select_2 {
          width: 220px;
          margin: 20px 0 20px 0;
        }
        .select_3 {
          width: 172px;
          margin-left: 10px;
        }
        .label1 {
          margin: 20px 0 20px 0;
          border-bottom: 1px solid #cdcdcd;
          .labelRight > div {
            margin-bottom: 20px;
          }
          .input2 {
            width: 250px;
          }
          .input3 {
            width: 150px;
          }
          .input4 {
            width: 250px;
          }
          .input5 {
            width: 450px;
          }
          .input6 {
            width: 630px;
            margin-right: 24px;
          }
          button {
            width: 253px;
            background-color: #4a3f91;
            color: #fff;
            margin-left: 25px;
          }
          .label1_span {
            margin-left: 20px;
          }
        }
        .box-card_3 {
          margin-top: 20px;
          position: relative;
          overflow: initial;
          .title {
            overflow: hidden;
            img {
              float: left;
            }
            p {
              height: 25px;
              line-height: 24px;
              font-size: 18px;
              margin: 0 0 0 40px;
              font-weight: 600;
              color: black;
            }
          }
          .content {
            .el-input {
              width: 220px;
              margin: 0 0 20px 20px;
            }
            /*这里是改div变成输入框形式*/
            overflow: hidden;
            .title-span {
              height: 40px;
              line-height: 40px;
              float: left;
            }
            .search {
              float: left;
              display: inline-block;
              width: 220px;
              margin: 0 20px 0 20px;
              height: 40px;
              line-height: 40px;
              text-indent: 1em;
              border: 1px solid #dcdcdc;
              border-radius: 4px;
              overflow: hidden;
              cursor: pointer;
              i {
                float: right;
                margin-top: 15px;
                margin-right: 12px;
              }
            }
            .el-select {
              width: 220px;
              margin: 0 20px 0 20px;
            }
            .el-button {
              width: 130px;
              background-color: #4a3f91;
              color: #fff;
            }
            .fee-content {
              margin-top: 32px;
            }
          }
        }
      }

      .content_4 {
        .input7 {
          width: 220px;
        }
        .el-select:nth-of-type(1) {
          width: 220px;
          margin-left: 5px;
          margin-bottom: 20px;
        }
        .el-select:nth-of-type(2) {
          width: 220px;
          margin-left: 18px;
        }
      }

      .content_5 {
        text-align: center;
        margin-top: 20px;
        .el-button {
          width: 275px;
          background-color: #f08519;
          color: #fff;
          font-weight: bold;
        }
      }
    }

    .box-card_31 {
      background: white;
      /*padding:20px 20px 60px 20px;*/
      margin-top: 20px;
      .title {
        overflow: hidden;
        img {
          float: left;
        }
        p {
          height: 25px;
          line-height: 24px;
          font-size: 18px;
          margin: 0 0 0 40px;
          font-weight: 600;
          color: black;
        }
      }
      .item {
        .dingchuancount {
          font-size: 0.875rem;
          margin: 10px 0 0 0;
          .dingchuancount-title {
            color: #4a3f91;
            font-weight: 600;
          }
          .dingchuancount-content {
            margin: 10px 0 20px 0;
            .grid-content {
              margin: 0 0 10px 0;
            }
          }
        }
        .tuochecount {
          font-size: 0.875rem;
          margin: 10px 0 30px 0;
          border-bottom: 1px solid #e6e6e6;
          .tuochecount-title {
            color: #4a3f91;
            font-weight: 600;
          }
          .tuochecount-content {
            margin: 10px 0 20px 0;
            .grid-content {
              margin: 0 0 10px 0;
              .tuochefuwufee {
                display: flex;
                div:nth-of-type(1) {
                  margin-right: 10px;
                }
                div:nth-of-type(2) {
                  font-size: 0.875rem;
                }
              }
            }
          }
        }
        .count {
          .grid-content {
            font-size: 1rem;
            img {
              float: left;
            }
            p {
              height: 30px;
              line-height: 30px;
              margin-left: 40px;
              /*font-size: 1.2rem;*/
              font-size: 18px;
              font-weight: 600;
            }
            span {
              color: #f08619;
              font-weight: 600;
            }
          }
        }
        .el-button {
          width: 186px;
          background-color: #f08519;
          color: #fff;
          font-weight: bold;
        }
      }
    }
  }
}
.myaddress {
  .eldialog-title {
    p {
      display: inline-block;
      width: 20%;
      height: 40px;
      line-height: 40px;
      border-bottom: 1px solid #ddd;
      margin-bottom: 10px;
    }
  }
  .eldialog-list {
    cursor: pointer;
    height: 30px;
    line-height: 30px;
    p {
      display: inline-block;
      width: 20%;
    }
  }
}
.showform {
  position: absolute;
  background: white;
  z-index: 11;
  top: 110px;
  left: 12.2%;
  border: 1px solid #ddd;
  width: 549px;
  padding: 0 10px 20px 10px;
  .swiper-container {
    line-height: 40px;
    height: 40px;
    border-bottom: 1px solid #ddd;
    .swiper-slide {
      text-align: center;
      cursor: pointer;
      /*width: 62.8333px;*/
      /*min-width: 70px;*/
    }
    .swiper-slide-active1 {
      border-bottom: 3px solid #4b3f91;
      color: #4b3f91;
      font-weight: 600;
    }
    .swiper-slide-active2 {
      border-bottom: 3px solid #4b3f91;
      color: #4b3f91;
      font-weight: 600;
    }
  }
  .port {
    cursor: pointer;
    p {
      width: 33.33%;
      display: inline-block;
      text-align: center;
      padding: 10px 0 0 0;
    }
  }
}
#searchBox1 {
  top: 110px;
}
.vslvoy{
  float: right;
    margin-right: 19.5%;
}

</style>
<style lang="scss">
.el-dialog {
  width: 62% !important;
  .el-dialog__header {
    text-align: center;
    color: #000;
    font-weight: bold;
    font-size: 1.2rem;
  }
  .el-dialog__body {
    padding: 0 20px 30px 20px;
  }
}
</style>
<template>
  <section class="container">
    <div>
      <topheader/>
      <contentheader/>
      <div>
        <!-- <div class="pageouter"></div> -->
        <div class="layout">
          <div class="orderConfirm-tab">
            <el-breadcrumb separator-class="el-icon-arrow-right">
              <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
              <el-breadcrumb-item>订舱下单</el-breadcrumb-item>
            </el-breadcrumb>
          </div>
          
          <div class="content" v-loading="loading">
            <!--第1卡片内容-->
            <el-card class="box-card_1">
              <div class="content_1">
                <div>
                  <p>
                    <span>起运港（码头）</span>
                    <img src="../assets/img/dc_jiantou2.jpg" alt>
                    <span>目的港（码头）</span>
                    <span>运输方式 · 行程</span>
                  </p>
                </div>
                <div>
                  <p>{{dingcangdata.pol_en_name}}&nbsp;{{dingcangdata.pol_cn_name}}</p>
                  <p>{{dingcangdata.pod_en_name}}&nbsp;{{dingcangdata.pod_cn_name}}</p>
                 <p>
                    <span>海运 · {{dingcangdata.days}}天</span>
                  </p>
                </div>
             </div>
              <div class="content_2">
                <p>
                  <span>有效期</span>
                  <span>船期</span>
                  <span>航东</span>
                  <span>船名/航次</span>
                </p>
                <p>
                  <span style="color: #999">【预计开船】</span>
                  <span>{{dingcangdata.sail_date}}</span>
                  <span >周{{dingcangdata.sail_week_day | changeToC}}</span>
                  <button>{{showcarrier_en_name}}</button>
                  <span class="vslvoy">VSL/VOY：{{dingcangdata.carrier_en_name}}/{{dingcangdata.carrier_cn_name}}</span>
                </p>
                <p>
                  <span style="color: #999">【截至订舱】</span>
                  <span>{{dingcangdata.end_date}}</span>
                  <span>{{dingcangdata.end_weed_day | changeToC }}截{{dingcangdata.sail_week_day | changeToC}}开</span>
                </p>
              </div>
            </el-card>
            <el-card class="box-card_2">
              <div class="header">
                <img src="../assets/img/icon8.jpg" height="30" width="30">
                <span>选择货柜</span>
              </div>
              <div class="content_1">
                <div class="ASDSA">
                  <div>
                    <img src="../assets/img/icon9.jpg" alt>
                    <span>20'GP</span>
                  </div>
                  <div>
                    <span>$ {{dingcangdata.gp20_price}}</span>
                  </div>
                  <div>
                    <el-input-number
                      v-model="num1"
                      @change="handleChange"
                      :min="0"
                      :max="99"
                      label="描述文字"
                    ></el-input-number>
                  </div>
                </div>
                <div class="ASDSA">
                  <div>
                    <img src="../assets/img/icon9.jpg" alt>
                    <span>40'GP</span>
                  </div>
                  <div>
                    <span>$ {{dingcangdata.gp40_price}}</span>
                  </div>
                  <div>
                    <el-input-number
                      v-model="num2"
                      @change="handleChange"
                      :min="0"
                      :max="99"
                      label="描述文字"
                    ></el-input-number>
                  </div>
                </div>
                <div class="ASDSA">
                  <div>
                    <img src="../assets/img/icon9.jpg" alt>
                    <span>40'HQ</span>
                  </div>
                  <div>
                    <span>$ {{dingcangdata.hq40_price}}</span>
                  </div>
                  <div>
                    <el-input-number
                      v-model="num3"
                      @change="handleChange"
                      :min="0"
                      :max="99"
                      label="描述文字"
                    ></el-input-number>
                  </div>
                </div>
              </div>
              <div class="header" v-if="checked1">
                <img src="../assets/img/icon11.jpg" height="30" width="30">
                <span>拖柜地点</span>
              </div>
              <div class="content_3">
                <div v-if="checked1">
                  <el-select
                    class="select_1"
                    @change="getaddresscity"
                    v-model="address_sheng"
                    placeholder="请选择省份"
                  >
                    <el-option
                      v-for="item in address_sheng_obj"
                      :key="item.id"
                      :label="item.name"
                      :value="item.id"
                    ></el-option>
                  </el-select>
                  <el-select
                    class="select_1"
                    @change="getaddressarea"
                    v-model="address_city"
                    placeholder="请选择城市"
                  >
                    <el-option
                      v-for="item in address_city_obj"
                      :key="item.id"
                      :label="item.name"
                      :value="item.id"
                    ></el-option>
                  </el-select>
                  <el-select
                    class="select_1"
                    @change="getaddresszhen"
                    v-model="address_area"
                    placeholder="请选择区域"
                  >
                    <el-option
                      v-for="item in address_area_obj"
                      :key="item.id"
                      :label="item.name"
                      :value="item.id"
                    ></el-option>
                  </el-select>
                  <el-select
                    class="select_1"
                    @change="changeaddresszhen"
                    v-model="address_zhen"
                    placeholder="请选择乡镇"
                  >
                    <el-option
                      v-for="item in address_zhen_obj"
                      :key="item.id"
                      :label="item.name"
                      :value="item.id"
                    ></el-option>
                  </el-select>
                  <br>
                  <el-date-picker v-model="elDate" type="date" placeholder="选择日期"></el-date-picker>
                  <br>
                  <el-checkbox class="checkbox3" v-model="checked3">20'GP柜可以孖拖</el-checkbox>
                  <span>孖拖数量：</span>
                  <el-input class="input1" v-model="input1" placeholder></el-input>
                  <br>
                  <span>过磅类型：</span>
                  <el-select
                    class="select_2"
                    @change="getguobangtype"
                    v-model="value1"
                    placeholder="请选择过磅类型"
                  >
                    <el-option
                      v-for="(item,index,key) in weigh_type"
                      :key="key"
                      :label="item"
                      :value="index"
                    ></el-option>
                  </el-select>
                  <br>
                  <span>熏蒸柜：</span>
                  <el-checkbox class="checkbox4" v-model="checked4">需要</el-checkbox>
                  <el-select
                    class="select_3"
                    v-model="value4"
                    :disabled="!checked4"
                    placeholder="请选择熏蒸数量"
                  >
                    <el-option
                      v-for="item in options4"
                      :key="item.value"
                      :label="item.label"
                      :value="item.value"
                    ></el-option>
                  </el-select>
                  <el-row v-for="(item,index,key) in addressdata" :key="key" class="label1">
                    <el-col :span="2">
                      <div class="grid-content bg-purple">
                        <span>拖柜地点{{index+1}}：</span>
                      </div>
                    </el-col>
                    <el-col :span="22">
                      <div class="grid-content bg-purple labelRight">
                        <div>
                          <span>工厂名称：</span>
                          <el-input class="input2" v-model="item.company_name"></el-input>
                          <span class="label1_span">工厂联系人：</span>
                          <el-input class="input3" v-model="item.contact_name"></el-input>
                          <span class="label1_span">联系电话/手机：</span>
                          <el-input class="input4" v-model="item.contact_phone"></el-input>
                        </div>
                        <div>
                          <el-input class="input5" v-model="item.address" placeholder="工厂详细地址"></el-input>
                          <el-button @click="selectaddress(index)">从我的拖柜地点选择</el-button>
                        </div>
                        <div>
                          <span>备注：</span>
                          <el-input class="input6" v-model="item.comment"></el-input>
                          <el-checkbox class="checkbox4" v-model="checked5">加到我的拖柜地点</el-checkbox>
                        </div>
                        <div>
                          <span
                            v-if="index===0"
                            style="color: #f08519;cursor: pointer;"
                            @click="addaddress"
                          >+ 新增拖柜地点</span>
                          <span
                            v-if="index!==0"
                            style="color: #4a3f91;cursor: pointer;"
                            @click="deladdress(index)"
                          >- 删除此地址</span>
                        </div>
                      </div>
                    </el-col>
                  </el-row>
                </div>
                <div v-show="checked2">
                  <el-card class="box-card_3">
                    <div class="title">
                      <img src="../assets/img/icon6.png" height="30" width="30">
                      <p>报关信息</p>
                    </div>
                    <div class="content">
                      <span class="title-span">报关地点：</span>
                      <div id="search1" class="search">
                        <span>{{baoguanitem.cn_name}}</span>
                        <i id="searchi1"
                          :class="{'el-icon-arrow-down':!showchoosecity,'el-icon-arrow-up':showchoosecity}"
                        ></i>
                      </div>
                      <el-button @click="checkbaoguan">查询价格</el-button>
                      <div class="fee-content" v-show="baoguanInfo !== null">
                        <el-row>
                          <el-col :span="6">
                            <div class="grid-content bg-purple">报关服务费:{{baoguanservicefee}}</div>
                          </el-col>
                          <el-col :span="6">
                            <div class="grid-content bg-purple">联单费:{{liandanfee}}</div>
                          </el-col>
                        </el-row>
                      </div>
                    </div>
                    <!--//弹出框-->
                    <div id="searchBox1" class="showform" v-show="showchoosecity">
                      <div id="searchBox_title1" class="swiper-container swiper-container0">
                        <div class="swiper-wrapper swiper-wrapper0 wrap">
                          <div
                            :class="{'swiper-slide-active1':(item.id === tanguangid1)} "
                            class="swiper-slide swiper-slide0"
                            :id="item.id"
                            :key="key"
                            v-for="(item,index,key) in city"
                            @click="choosecity(item.id)"
                          >{{item.cn_name}}</div>
                        </div>
                      </div>
                      <div class="port">
                        <p
                          v-for="(item,index,key) in port1"
                          :key="key"
                          @click="choosecity2(item,1)"
                        >
                          <span>{{item.cn_name}}</span>
                        </p>
                      </div>
                    </div>
                  </el-card>
                </div>
                <div class="content_5">
                  <el-button @click="culfee">计算费用</el-button>
                </div>
              </div>
            </el-card>
            <el-card class="box-card_31" v-if="showfee">
              <div class="title">
                <img src="../assets/img/oktitle.png" height="28" width="30">
                <p>费用明细</p>
              </div>
              <div class="item">
                <div class="dingchuancount">
                  <div class="dingchuancount-title">订舱费用</div>
                  <div class="dingchuancount-content">
                    <el-row>
                      <el-col :span="6" v-for="(item,index,key) in fujiafee" :key="key">
                        <div
                          class="grid-content bg-purple"
                        >{{item.name}}:{{item.currency}}&nbsp;&nbsp;{{item.fee}}</div>
                      </el-col>
                    </el-row>
                  </div>
                </div>
                <div class="tuochecount" v-if="checked1">
                  <div class="tuochecount-title">拖车费用</div>
                  <div class="tuochecount-content">
                    <el-row>
                      <el-col :span="6">
                        <div class="grid-content bg-purple">拖车费:{{tuochefee}}</div>
                      </el-col>
                      <el-col :span="6">
                        <div class="grid-content bg-purple">
                          <div class="tuochefuwufee">
                            <div>拖车服务费:</div>
                            <div>
                              <p v-for="(item,index,key)  in tuochecheckfujiafee" :key="key">
                                <span>{{item.surcharge_cn_name}}:</span>
                                <span>{{item.price}}</span>
                              </p>
                            </div>
                          </div>
                        </div>
                      </el-col>
                      <el-col :span="6" v-if="checked2">
                        <div class="grid-content bg-purple">报关服务费:{{baoguanservicefee}}</div>
                      </el-col>
                      <el-col :span="6" v-if="checked2">
                        <div class="grid-content bg-purple">联单费:{{liandanfee}}</div>
                      </el-col>
                    </el-row>
                  </div>
                </div>
                <div class="count">
                  <el-row>
                    <el-col :span="6">
                      <div class="grid-content bg-purple">
                        <img src="../assets/img/qian.png" height="30" width="30">
                        <p>预估费用总计：</p>
                      </div>
                    </el-col>
                    <el-col :span="6">
                      <div style="margin-top: 4px" class="grid-content bg-purple">
                        <span>USD {{countfee1}} 起</span>
                      </div>
                    </el-col>
                    <el-col :span="6">
                      <div style="margin-top: 4px" class="grid-content bg-purple">
                        <span>CNY {{countfee2+ tuochefee +tuochecountfujiafei+ baoguanservicefee+ liandanfee }}</span>
                      </div>
                    </el-col>
                    <el-button @click="weituo">立即委托</el-button>
                  </el-row>
                </div>
              </div>
            </el-card>
          </div>
        </div>
        <!-- <div class="pageouter"></div> -->
      </div>
      <homeguarantees/>
      <webfooter/>
    </div>
    <el-dialog title="我的拖柜地点" :visible.sync="dialogTableVisible">
      <div class="myaddress">
        <div class="eldialog-title">
          <p>公司名称</p>
          <p>公司详细地址</p>
          <p>工厂联系人</p>
          <p>联系电话</p>
          <p>操作</p>
        </div>
        <div
          class="eldialog-list"
          v-for="(item,index,key) in addressdata1"
          :key="key"
          @click="chooseaddress(item)"
        >
          <p>{{item.company_name}}</p>
          <p>{{item.district_full_name}}</p>
          <p>{{item.contact_name}}</p>
          <p>{{item.contact_phone}}</p>
          <p>选择</p>
        </div>
      </div>
    </el-dialog>
    <!--弹出内容-->
    <modal @on-close="closeThis()" :is-show="isShowLogin"></modal>
  </section>
  
</template>

<script>
import topheader from "../components/comment/topheader.vue";
import contentheader from "../components/comment/contentheader.vue";
import homeguarantees from "../components/home/homeguarantees.vue";
import webfooter from "../components/comment/webfooter.vue";
// import Swiper from "swiper/dist/js/swiper.min";
const modal = () => import("~/components/comment/loginModel");
export default {
  name: "cabinOrder",
  components: {
    topheader,
    contentheader,
    homeguarantees,
    webfooter,
    modal
  },
  filters: {
    changeToC: function (value) {
      switch(value){
        case "1":
        return '一';
        break
         case "2":
        return '二';
        break
         case "3":
        return '三';
        break
         case "4":
        return '四';
        break
         case "5":
        return '五';
        break
         case "6":
        return '六';
        break
         case "7":
        return '日';
        break
      }
      return (value + 1)
    },
  },
  data() {
    return {
       isShowLogin: false,
      //计算费用
      showfee: false,
      //报关地点选择
      showchoosecity: false,
      baoguanitem: { cn_name: "请选择城市" },
      tanguangid1: null,
      port1: [],
      baoguanInfo: null,
      baoguanservicefee: null,
      liandanfee: null,
      dialogTableVisible: false,
      addressdata1: [],
      //基础数据
      initData: {},
      city: [],
      address_sheng: "", //拖柜省
      address_sheng_obj: null, //拖柜省
      address_sheng_id: null,
      address_city: "", //拖柜市
      address_city_obj: null, //拖柜市
      address_city_id: null,
      address_area: "", //拖柜区域
      address_area_obj: null, //拖柜区域
      address_area_id: null,
      address_zhen: "", //拖柜乡镇
      address_zhen_obj: null, //拖柜乡镇
      address_zhen_id: null,
      weigh_type: {},
      vgmway: "",
      vgmway_options: [],
      put_position: "",
      put_position_options: [],
      value1: "", //过磅类型的显示
      guobangtype: "", //过磅类型
      //地点数据
      addressdata: [
        {
          district_id: "",
          company_name: "",
          address: "",
          contact_name: "",
          contact_phone: "",
          comment: ""
        }
      ],
      dingcangdata: {},
      num1: 0,
      num2: 0,
      num3: 0,
      checked1: false,
      checked2: false,
      checked3: false,
      checked4: false,
      checked5: false,
      elDate: "",
      input1: "",
      input2: "",
      input3: "",
      input4: "",
      options4: [
        { value: "1", label: "1" },
        { value: "2", label: "2" },
        { value: "3", label: "3" },
        { value: "4", label: "4" },
        { value: "5", label: "5" },
        { value: "6", label: "6" },
        { value: "7", label: "7" },
        { value: "8", label: "8" },
        { value: "9", label: "9" }
      ],
      value4: "",
      //        附加费
      fujiafee: [],
      tuochecheck: {}, //拖车费用
      tuochecheckdetails: {}, //拖车费用详情
      tuochecheckfujiafee: {}, //拖车费用附加费
      tuochefee: 0,
      tuochecountfujiafei: 0,
      //总价
      countfee1: 0,
      countfee2: 0,
      loading: true,
      ways: "",
      showcarrier_en_name: "",
    };
  },
  methods: {
    handleChange(value) {},
    //选择城市
    choosecity(id) {
      this.tanguangid1 = id;
      this.getprot(id);
    },
    //获取港口数据
    getprot(id) {
      var that = this;
      let url = that.$store.state.headerUrl + "freight/port_by_pid/" + id;
      let tempalert = that.$alert;
      that.comment
        .axiosGet(url, that.$axios, that.$store, {}, tempalert, that)
        .then(function(resp) {
          that.port1 = resp.data.data;
        });
    },
    choosecity2(item) {
      this.baoguanitem = item;
    },
    getcity(value) {
      let that = this;
      that.trailer_city_id = value;
      that.trailer_port = "";
      that.getport();
    },
    //获取选择的港口id
    getportid(value) {
      this.trailer_port_id = value;
    },
    //查询港口信息
    getport() {
      let that = this;
      let url =
        that.$store.state.headerUrl +
        "freight/port_by_pid/" +
        that.trailer_city_id;
      let tempalert = that.$alert;
      that.comment
        .axiosGet(url, that.$axios, that.$store, {}, tempalert, that)
        .then(function(resp) {
          if (resp.data.code === 0) {
            that.port = resp.data.data;
          }
          /*else{
            tempalert(resp.data.msg, {
              confirmButtonText: '确定',
              callback: action => {
              }
            });
          }*/
        })
        .catch(function(error) {
          tempalert(error, {
            confirmButtonText: "确定",
            callback: action => {}
          });
        });
    },
    //查询省市区镇 id,index[0：省，1：市，2：区，3：镇]
    getaddress(id, index) {
      let that = this;
      let url = that.$store.state.headerUrl + "district/" + id;
      let tempalert = that.$alert;
      that.comment
        .axiosGet(url, that.$axios, that.$store, {}, tempalert, that)
        .then(function(resp) {
          if (resp.data.code === 0) {
            if (index === 0) {
              that.address_sheng_obj = resp.data.data;
            } else if (index === 1) {
              that.address_city_obj = resp.data.data;
            } else if (index === 2) {
              that.address_area_obj = resp.data.data;
            } else if (index === 3) {
              that.address_zhen_obj = resp.data.data;
            }
            that.loading = false;
          }
        })
        .catch(function(error) {
          tempalert(error, {
            confirmButtonText: "确定",
            callback: action => {}
          });
        });
    },
    //监听省变化
    getaddresscity(value) {
      let that = this;
      that.address_sheng_id = value;
      that.address_city_obj = null;
      that.address_area_obj = null;
      that.address_zhen_obj = null;
      that.address_city = "";
      that.address_area = "";
      that.address_zhen = "";
      that.address_city_id = null;
      that.address_area_id = null;
      that.address_zhen_id = null;
      that.getaddress(value, 1);
    },
    //监听市变化
    getaddressarea(value) {
      let that = this;
      that.address_city_id = value;
      that.address_area_obj = null;
      that.address_zhen_obj = null;
      that.address_area = "";
      that.address_zhen = "";
      that.address_area_id = null;
      that.address_zhen_id = null;
      that.getaddress(value, 2);
    },
    //监听市变化
    getaddresszhen(value) {
      let that = this;
      that.address_area_id = value;
      that.address_zhen_obj = null;
      that.address_zhen = "";
      that.address_zhen_id = null;
      that.getaddress(value, 3);
    },
    //监听乡镇变化
    changeaddresszhen(value) {
      let that = this;
      that.address_zhen_id = value;
    },
    //过磅类型
    getguobangtype(value) {
      this.guobangtype = value;
    },
    addaddress() {
      this.addressdata.push({
        district_id: "",
        company_name: "",
        address: "",
        contact_name: "",
        contact_phone: "",
        comment: ""
      });
    },
    deladdress(index) {
      this.addressdata.splice(index, 1);
    },
    //获取我的地址数据
    getaddressdata() {
      let that = this;
      let tempalert = that.$alert;
      let url = that.$store.state.headerUrl + "freight/trailer/address";
      that.comment
        .axiosGet(url, that.$axios, that.$store, {}, tempalert, that)
        .then(function(resp) {
          if (resp.data.code === 0) {
            that.addressdata1 = resp.data.data;
            that.dialogTableVisible = true;
          }
        })
        .catch(function(error) {
          tempalert(error, {
            confirmButtonText: "确定",
            callback: action => {}
          });
        });
    },
    //打开选择地点弹框
    selectaddress(index) {
      let that = this;
      that.chooseindex = index;
      if (that.addressdata1.length === 0) {
        that.getaddressdata();
      } else {
        that.dialogTableVisible = true;
      }
    },
    //选择地点
    chooseaddress(item) {
      this.addressdata[this.chooseindex] = {
        district_id: item.district_id,
        company_name: item.company_name,
        address: item.address,
        contact_name: item.contact_name,
        contact_phone: item.contact_phone,
        comment: ""
      };
      this.dialogTableVisible = false;
      this.chooseindex = null;
    },
    //绑定弹出框
    //计算费用
    culfee() {
      let that = this;
      that.countfee1 = 0;
      that.countfee2 = 0;
      that.fujiafee = [];
      //计算订舱附加费
      for (var i = 0; i < that.dingcangdata.surcharge.length; i++) {
        if (that.dingcangdata.surcharge[i].type === "0") {
          let name = that.dingcangdata.surcharge[i].surcharge_cn_name;
          let fee = that.dingcangdata.surcharge[i].price;
          let currency = that.dingcangdata.surcharge[i].currency;
          that.fujiafee.push({ name: name, fee: fee, currency: currency });
        } else {
          let name = that.dingcangdata.surcharge[i].surcharge_cn_name;
          let currency = that.dingcangdata.surcharge[i].currency;
          let fee =
            Number(that.num1) *
              Number(that.dingcangdata.surcharge[i].gp20_price) +
            Number(that.num2) *
              Number(that.dingcangdata.surcharge[i].gp40_price) +
            Number(that.num3) *
              Number(that.dingcangdata.surcharge[i].hq40_price);
          that.fujiafee.push({ name: name, fee: fee, currency: currency });
          //            that.fujiafee.push({name:name,fee:fee});
        }
      }
      let tempcount = 0;
      let tempcount1 = 0;
      //订舱附加费
      for (var i = 0; i < that.fujiafee.length; i++) {
        if (that.fujiafee[i].currency === "CNY") {
          tempcount1 = tempcount1 + Number(that.fujiafee[i].fee);
        } else {
          tempcount = tempcount + Number(that.fujiafee[i].fee);
        }
      }
      //订舱总费用
      that.countfee1 =
        Number(that.num1) * Number(that.dingcangdata.gp20_price) +
        Number(that.num2) * Number(that.dingcangdata.gp40_price) +
        Number(that.num3) * Number(that.dingcangdata.hq40_price) +
        tempcount; //USD总价
      that.countfee2 = tempcount1; //CNY总价
      //计算拖车费用
      if (that.checked1) {
        //计算拖车费
        that.gettuochefee();
      }
      //报关费用
      if (that.checked2) {
        that.checkbaoguan();
      }
      that.showfee = true;
    },
    //查询拖车费用
    gettuochefee() {
      let that = this;
      let tempalert = that.$alert;
      let url = that.$store.state.headerUrl + "freight/trailer/goods";
      if (that.elDate === "") {
        tempalert("请选择日期", {
          confirmButtonText: "确定",
          callback: action => {}
        });
        return;
      }
      //是否孖拖取值
      let temp_is_gp_20_twin = null;
      if (that.checked3) {
        temp_is_gp_20_twin = 1; // 孖拖
      } else {
        temp_is_gp_20_twin = 0; //不孖拖
      }
      //脱轨地点取值
      let temp_district_id = null;
      /*if(that.address_zhen_id === null){
          tempalert('请选择完整的拖柜地点', {
            confirmButtonText: '确定',
            callback: action => {
            }
          });
          return
        }else{
           temp_district_id = that.address_zhen_id;
         };*/
      if (that.address_sheng_id === null) {
        tempalert("请选择拖柜地点", {
          confirmButtonText: "确定",
          callback: action => {}
        });
        return;
      } else if (that.address_city_id === null) {
        temp_district_id = that.address_sheng_id;
      } else if (that.address_area_id === null) {
        temp_district_id = that.address_city_id;
      } else if (that.address_zhen_id === null) {
        temp_district_id = that.address_area_id;
      } else {
        temp_district_id = that.address_zhen_id;
      }
      let has_customs_declare = 0;
      if (that.checked2) {
        has_customs_declare = 1;
      } else {
        has_customs_declare = 0;
      }
      let params = {
        port_id: Number(that.dingcangdata.pol),
        district_id: temp_district_id,
        gp_20_num: Number(that.num1),
        gp_40_num: Number(that.num2),
        hq_40_num: Number(that.num3),
        hq_45_num: 0,
        has_customs_declare: has_customs_declare,
        is_gp_20_twin: temp_is_gp_20_twin
      };
      that.comment
        .axiosPost(url, that.$axios, that.$store, params, tempalert, that)
        .then(function(resp) {
          if (resp.data.code === 0) {
            that.tuochecheck = resp.data.data[0];
            that.getPricedetails(that.tuochecheck.id);
          }
          /* else{
            tempalert(resp.data.msg, {
              confirmButtonText: '确定',
              callback: action => {
              }
            });
          }*/
        });
    },
    //拖车费用详情
    getPricedetails(id) {
      var that = this;
      let tempalert = that.$alert;
      let url = that.$store.state.headerUrl + "freight/trailer/goods/" + id;
      that.comment
        .axiosGet(url, that.$axios, that.$store, {}, tempalert, that)
        .then(function(resp) {
          if (resp.data.code === 0) {
            that.tuochecheckdetails = resp.data.data;
            that.tuochecheckfujiafee = resp.data.data.surcharge;
            let matuofee = 0;
            let tempmatuonum = 0;
            let temp20gpnum = 0;
            if (that.checked3) {
              tempmatuonum = parseInt(Number(that.num1) / 2);
              temp20gpnum = Number(that.num1) % 2;
              that.tuochefee =
                temp20gpnum * that.tuochecheckdetails.gp20_price +
                Number(that.num2) * that.tuochecheckdetails.gp40_price +
                Number(that.num3) * that.tuochecheckdetails.hq40_price +
                0 * that.tuochecheckdetails.hq45_price +
                tempmatuonum * that.tuochecheckdetails.gp20twin_price;
            } else {
              temp20gpnum = Number(that.num1);
              that.tuochefee =
                temp20gpnum * that.tuochecheckdetails.gp20_price +
                Number(that.num2) * that.tuochecheckdetails.gp40_price +
                Number(that.num3) * that.tuochecheckdetails.hq40_price +
                0 * that.tuochecheckdetails.hq45_price;
            }
            let countfujiafei = 0;
            for (var i = 0; i < that.tuochecheckfujiafee.length; i++) {
              countfujiafei = countfujiafei + that.tuochecheckfujiafee[i].price;
            }
            that.tuochecountfujiafei = countfujiafei;
          }
          /*else{
            tempalert(resp.data.msg, {
              confirmButtonText: '确定',
              callback: action => {
              }
            });
          }*/
        })
        .catch(function(error) {
          tempalert(error, {
            confirmButtonText: "确定",
            callback: action => {}
          });
        });
    },
    //查询报关费用
    checkbaoguan() {
      let that = this;
      let url =
        that.$store.state.headerUrl +
        "freight/customs_declare/goods/" +
        that.baoguanitem.id;
      let tempalert = that.$alert;
      that.comment
        .axiosGet(url, that.$axios, that.$store, {}, tempalert, that)
        .then(function(resp) {
          if (resp.data.code === 0) {
            that.baoguanInfo = resp.data.data;
            that.baoguanservicefee = that.baoguanInfo.service_fee;
            that.liandanfee = that.baoguanInfo.bill_fee;
          }
          /* else{
            tempalert(resp.data.msg, {
              confirmButtonText: '确定',
              callback: action => {
              }
            });
          }*/
        })
        .catch(function(error) {
          tempalert(error, {
            confirmButtonText: "确定",
            callback: action => {}
          });
        });
    },
    //提交订单
    weituo() {
      if(localStorage.getItem('token')){

let that = this;
      let tempalert = that.$alert;
      let url = that.$store.state.headerUrl + "freight_order";
      let params = {};
      let shipping = {
        shipping_goods_id: Number(that.dingcangdata.id),
        gp20_num: Number(that.num1),
        gp40_num: Number(that.num2),
        hq40_num: Number(that.num3)
      };
      params.shipping = shipping;
      let customs_declare = {};
      if (that.checked2) {
        customs_declare = {
          customs_declare_goods_id: Number(that.baoguanInfo.id)
        };
      }
      let trailer = {};
      if (that.checked1) {
        let tempmatuonum = 0;
        let temp20gpnum = 0;
        if (that.checked3) {
          tempmatuonum = parseInt(Number(that.num1) / 2);
          temp20gpnum = Number(that.num1) % 2;
        } else {
          temp20gpnum = Number(that.num1);
        }
        let need_fumigating_cabinet = 0;
        let need_fumigating_cabinet_num = 0;
        if (that.checked4) {
          need_fumigating_cabinet = 1;
          need_fumigating_cabinet_num = Number(that.value4);
        } else {
          need_fumigating_cabinet = 0;
          need_fumigating_cabinet_num = 0;
        }
        for (var i = 0; i < that.addressdata.length; i++) {
          that.addressdata[i].district_id = Number(
            that.addressdata[i].district_id
          );
        }
        trailer = {
          trailer_goods_id: that.tuochecheckdetails.id,
          trailer_date: that.comment.formate(
            "yyyy-MM-dd",
            new Date(that.elDate)
          ),
          gp20_num: Number(temp20gpnum),
          gp40_num: Number(that.num2),
          hq40_num: Number(that.num3),
          hq45_num: 0,
          gp20_twin_num: Number(tempmatuonum),
          weigh_type: that.guobangtype,
          need_fumigating_cabinet: need_fumigating_cabinet,
          fumigating_cabinet_num: need_fumigating_cabinet_num,
          address: that.addressdata
        };
      }

      //拼装数据
      if (that.checked2) {
        params.customs_declare = customs_declare;
      }
      if (that.checked1) {
        params.trailer = trailer;
      }
      that.comment
        .axiosPost(url, that.$axios, that.$store, params, tempalert, that)
        .then(function(resp) {
          if (resp.data.code === 0) {
            tempalert(resp.data.msg, {
              confirmButtonText: "确定",
              callback: action => {
                that.$router.push({ path: "member/pendingOrderlist" });
              }
            });
          }
        });
    



      }else{
        let tempnum = [this.num1,this.num2,this.num3];
         localStorage.setItem("cabintempnum", JSON.stringify(tempnum));
         this.isShowLogin = true;
      }
    },
    closeThis() {
      this.isShowLogin = false;
    },
    //登录弹出框的方法
    QQlogin() {},
    FBlogin() {},
      
  },
  mounted() {
    let that = this;
    that.getaddress(0, 0);

    // that.dingcangdata = JSON.parse(that.$route.query.data);

    that.dingcangdata = JSON.parse(localStorage.getItem("cabintempData"))
   //判断是否是reload
   
   if(localStorage.getItem('cabintempnum')){
     that.num1 = JSON.parse(localStorage.getItem("cabintempnum"))[0];
      that.num2 = JSON.parse(localStorage.getItem("cabintempnum"))[1];
       that.num3 = JSON.parse(localStorage.getItem("cabintempnum"))[2];
       that.culfee();
   }
    that.showcarrier_en_name = that.dingcangdata.carrier_en_name.split(" ")[0];
    //基础数据
    that.comment.initData(that.$store, that.$axios).then(function(resp) {
      localStorage.setItem("initData", JSON.stringify(resp));
      localStorage.setItem("initDataTime", new Date().getTime());
      that.initData = JSON.parse(localStorage.getItem("initData"));
      that.city = that.initData.city;
      that.tanguangid1 = that.city[0].id;
      that.getprot(that.city[0].id);
      that.weigh_type = that.initData.freight.weigh_type;
      that.vgmway_options = that.initData.freight.vgm;
      that.put_position_options = that.initData.freight.put_position;
      that.$store.commit("SET_TITLE", resp.freight.freight_name);
    });
  },
  watch: {
    checked1: function() {
      this.tuochefee = 0;
      this.tuochecountfujiafei = 0;
      this.showfee = false;
    },
    checked2: function() {
      this.baoguanservicefee = 0;
      this.liandanfee = 0;
      this.showfee = false;
    },
    checked4: function(oldval, val) {
      if (val === false) {
        this.value4 = "";
      }
    },
    num1: function() {
      if (this.showfee) {
        this.culfee();
      }
    },
    num2: function() {
      if (this.showfee) {
        this.culfee();
      }
    },
    num3: function() {
      if (this.showfee) {
        this.culfee();
      }
    }
  }
};
</script>



